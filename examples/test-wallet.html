<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test - Wallet Detection</title>
  <style>
    body {
      font-family: 'Monaco', 'Courier New', monospace;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #1e1e1e;
      color: #d4d4d4;
    }

    h1 {
      color: #4fc1ff;
      text-align: center;
    }

    .section {
      background: #252526;
      border: 1px solid #3e3e42;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }

    .section h2 {
      margin-top: 0;
      color: #dcdcaa;
      font-size: 1.2rem;
    }

    .status {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #3e3e42;
    }

    .status:last-child {
      border-bottom: none;
    }

    .label {
      color: #9cdcfe;
    }

    .value {
      color: #ce9178;
    }

    .ok {
      color: #4ec9b0;
    }

    .error {
      color: #f48771;
    }

    .warning {
      color: #dcdcaa;
    }

    button {
      background: #0e639c;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      margin-right: 10px;
      margin-top: 10px;
      font-family: inherit;
    }

    button:hover {
      background: #1177bb;
    }

    button:disabled {
      background: #3e3e42;
      cursor: not-allowed;
    }

    .log {
      background: #1e1e1e;
      border: 1px solid #3e3e42;
      border-radius: 6px;
      padding: 15px;
      margin-top: 15px;
      max-height: 400px;
      overflow-y: auto;
      font-size: 13px;
    }

    .log-line {
      margin: 3px 0;
      padding: 2px 0;
    }

    .log-time {
      color: #858585;
    }

    .log-info {
      color: #4fc1ff;
    }

    .log-success {
      color: #4ec9b0;
    }

    .log-error {
      color: #f48771;
    }

    .log-warn {
      color: #dcdcaa;
    }

    code {
      background: #1e1e1e;
      padding: 2px 6px;
      border-radius: 3px;
      color: #ce9178;
    }

    pre {
      background: #1e1e1e;
      border: 1px solid #3e3e42;
      padding: 10px;
      border-radius: 6px;
      overflow-x: auto;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <h1>üîç Wallet Detection Test</h1>

  <!-- Status -->
  <div class="section">
    <h2>Status</h2>
    <div class="status">
      <span class="label">window.ethereum:</span>
      <span class="value" id="ethereum-status">Checking...</span>
    </div>
    <div class="status">
      <span class="label">Wallet Type:</span>
      <span class="value" id="wallet-type">-</span>
    </div>
    <div class="status">
      <span class="label">Connected:</span>
      <span class="value" id="connected-status">No</span>
    </div>
    <div class="status">
      <span class="label">Account:</span>
      <span class="value" id="account">-</span>
    </div>
    <div class="status">
      <span class="label">Chain ID:</span>
      <span class="value" id="chain-id">-</span>
    </div>
  </div>

  <!-- Actions -->
  <div class="section">
    <h2>Actions</h2>
    <button onclick="checkWallet()">Check Wallet</button>
    <button onclick="connectWallet()">Connect Wallet</button>
    <button onclick="clearLog()">Clear Log</button>
  </div>

  <!-- Wallet Details -->
  <div class="section">
    <h2>Wallet Object</h2>
    <pre id="wallet-details">window.ethereum = undefined</pre>
  </div>

  <!-- Log -->
  <div class="section">
    <h2>Log</h2>
    <div class="log" id="log"></div>
  </div>

  <script>
    // Logging
    const logContainer = document.getElementById('log');
    let logCount = 0;

    function log(message, type = 'info') {
      logCount++;
      const time = new Date().toLocaleTimeString();
      const line = document.createElement('div');
      line.className = 'log-line';
      line.innerHTML = `<span class="log-time">[${time}]</span> <span class="log-${type}">${message}</span>`;
      logContainer.appendChild(line);
      logContainer.scrollTop = logContainer.scrollHeight;
    }

    function clearLog() {
      logContainer.innerHTML = '';
      logCount = 0;
      log('Log cleared', 'info');
    }

    // Check wallet
    function checkWallet() {
      log('Checking for wallet...', 'info');

      const hasEthereum = typeof window.ethereum !== 'undefined';
      const status = document.getElementById('ethereum-status');

      if (hasEthereum) {
        status.innerHTML = '<span class="ok">‚úì Available</span>';
        log('window.ethereum is available!', 'success');

        // Determine wallet type
        let walletType = 'Unknown';
        if (window.ethereum.isMetaMask) walletType = 'MetaMask';
        else if (window.ethereum.isCoinbaseWallet) walletType = 'Coinbase Wallet';
        else if (window.ethereum.isTrust) walletType = 'Trust Wallet';
        else if (window.ethereum.isBraveWallet) walletType = 'Brave Wallet';

        document.getElementById('wallet-type').textContent = walletType;
        log('Wallet type: ' + walletType, 'info');

        // Show wallet details
        const details = {
          isMetaMask: window.ethereum.isMetaMask,
          chainId: window.ethereum.chainId,
          selectedAddress: window.ethereum.selectedAddress,
          networkVersion: window.ethereum.networkVersion,
        };

        document.getElementById('wallet-details').textContent = JSON.stringify(details, null, 2);

        // Update chain ID
        if (window.ethereum.chainId) {
          const chainId = parseInt(window.ethereum.chainId, 16);
          document.getElementById('chain-id').textContent = chainId;
          log('Chain ID: ' + chainId, 'info');
        }

        // Update account
        if (window.ethereum.selectedAddress) {
          document.getElementById('account').textContent = window.ethereum.selectedAddress;
          document.getElementById('connected-status').innerHTML = '<span class="ok">Yes</span>';
          log('Already connected: ' + window.ethereum.selectedAddress, 'success');
        }

      } else {
        status.innerHTML = '<span class="error">‚úó Not Found</span>';
        log('window.ethereum NOT found!', 'error');
        log('Please install MetaMask or another Web3 wallet', 'warn');
        document.getElementById('wallet-details').textContent = 'window.ethereum = undefined';
      }
    }

    // Connect wallet
    async function connectWallet() {
      log('Attempting to connect wallet...', 'info');

      if (typeof window.ethereum === 'undefined') {
        log('ERROR: No wallet detected!', 'error');
        alert('Please install MetaMask or another Web3 wallet');
        return;
      }

      try {
        log('Requesting accounts...', 'info');
        const accounts = await window.ethereum.request({
          method: 'eth_requestAccounts'
        });

        if (accounts && accounts.length > 0) {
          const account = accounts[0];
          document.getElementById('account').textContent = account;
          document.getElementById('connected-status').innerHTML = '<span class="ok">Yes</span>';
          log('Connected successfully!', 'success');
          log('Account: ' + account, 'success');

          // Get chain ID
          const chainId = await window.ethereum.request({
            method: 'eth_chainId'
          });
          const chainIdDecimal = parseInt(chainId, 16);
          document.getElementById('chain-id').textContent = chainIdDecimal;
          log('Chain ID: ' + chainIdDecimal, 'info');

          alert('Connected!\n\nAccount: ' + account.substring(0, 10) + '...\nChain ID: ' + chainIdDecimal);
        }

      } catch (error) {
        log('ERROR: ' + error.message, 'error');
        log('Error code: ' + error.code, 'error');

        if (error.code === 4001) {
          log('User rejected the connection request', 'warn');
          alert('Connection rejected by user');
        } else {
          alert('Error: ' + error.message);
        }
      }
    }

    // Listen for events
    if (typeof window.ethereum !== 'undefined') {
      window.ethereum.on('accountsChanged', (accounts) => {
        log('accountsChanged event', 'info');
        if (accounts.length === 0) {
          log('Wallet disconnected', 'warn');
          document.getElementById('account').textContent = '-';
          document.getElementById('connected-status').textContent = 'No';
        } else {
          log('Account changed to: ' + accounts[0], 'info');
          document.getElementById('account').textContent = accounts[0];
        }
      });

      window.ethereum.on('chainChanged', (chainId) => {
        log('chainChanged event', 'info');
        const chainIdDecimal = parseInt(chainId, 16);
        log('Chain changed to: ' + chainIdDecimal, 'info');
        document.getElementById('chain-id').textContent = chainIdDecimal;
        location.reload();
      });

      window.ethereum.on('connect', (connectInfo) => {
        log('connect event', 'success');
        log('Connected to chain: ' + connectInfo.chainId, 'info');
      });

      window.ethereum.on('disconnect', (error) => {
        log('disconnect event', 'warn');
        log('Disconnected: ' + error.message, 'warn');
      });
    }

    // Auto-check on load
    window.addEventListener('load', () => {
      log('Page loaded', 'info');

      // Check immediately
      setTimeout(() => {
        checkWallet();
      }, 100);

      // Check again after 1 second (for slow-loading extensions)
      setTimeout(() => {
        log('Re-checking after 1 second...', 'info');
        checkWallet();
      }, 1000);

      // Listen for ethereum initialization
      window.addEventListener('ethereum#initialized', () => {
        log('ethereum#initialized event detected!', 'success');
        checkWallet();
      });
    });
  </script>
</body>
</html>
